# How does it work?

CMake can't build anything on its own – it relies on other tools in the system to perform
the actual compilation, linking, and other tasks. You can think of it as the orchestrator of
your building process: it knows what steps need to be done, what the end goal is, and how
to find the right workers and materials for the job.
# This process has three stages:
- ## Configuration
- ## Generation
- ## Building
![[Pasted image 20241222004519.png]]
# Этапы работы CMake

## Configuration Stage (Этап конфигурации)

### Что происходит:

- CMake читает файл `CMakeLists.txt` и связанные с ним дополнительные файлы.
- Анализируется конфигурация проекта:
    - Определяются параметры сборки, например, тип сборки (`Debug`, `Release`).
    - Проверяются зависимости, такие как наличие необходимых библиотек, компиляторов или SDK.
- Устанавливаются значения переменных CMake, например, `CMAKE_CXX_COMPILER` или `CMAKE_BUILD_TYPE`.
- Создаётся внутренняя модель проекта, которая используется на этапе генерации файлов сборки.

### Особенности:

- На этом этапе можно передать параметры конфигурации, такие как тип сборки или пути к зависимостям, используя ключи и переменные.

---

## Generation Stage (Этап генерации)

### Что происходит:

- На основе конфигурации создаются файлы сборки для выбранной системы сборки (Makefiles, Ninja, Visual Studio Project, Xcode Project и другие).
- Выбор генератора (например, `Unix Makefiles` или `Ninja`) осуществляется автоматически или задаётся вручную.
- CMake генерирует вспомогательные файлы, такие как `CMakeCache.txt`, которые хранят настройки для последующих запусков.

### Особенности:

- Генерация выполняется один раз, если конфигурация не менялась.
- Результатом этого этапа является набор файлов, которые обеспечивают сборку проекта.

---

## Building Stage (Этап сборки)

### Что происходит:

- Используются сгенерированные файлы сборки для запуска компиляции.
- Система сборки (например, Make или Ninja) компилирует исходный код:
    - Каждый исходный файл компилируется в объектный файл.
    - Объектные файлы связываются в итоговые артефакты, такие как исполняемые файлы или библиотеки.
- Выполняются действия, соответствующие указанной конфигурации (`Debug`, `Release`).

### Особенности:

- На этом этапе можно передавать дополнительные параметры, например, указать конкретную цель или тип конфигурации.



![[Pasted image 20241222030554.png]]

# Команда `cmake` с опциями `-S` и `-B` используется для явного указания:

- **`-S`**: пути к исходным кодам проекта (директория, содержащая `CMakeLists.txt`).
- **`-B`**: пути для размещения сгенерированных файлов сборки (директория, где будут храниться Makefile, Ninja, или другие файлы для сборки).

Эта команда выполняет **генерацию файлов сборки**, необходимых для последующего запуска системы сборки (например, `make` или `ninja`).

![[Pasted image 20241222030638.png]]
1. **`cmake -S ..`**:
    
    - **`-S ..`**: указывает, что исходный код и файл `CMakeLists.txt` находятся в директории выше (одним уровнем вверх от текущей директории).
    - Так как флаг `-B` не указан, файлы сборки будут созданы **в текущем каталоге** (где вы запускаете команду).
2. **`cmake -B build`**:
    
    - **`-B build`**: указывает, что все файлы сборки будут созданы в поддиректории `build` внутри текущей директории.
    - По умолчанию CMake ищет файл `CMakeLists.txt` и исходный код в **текущем каталоге** (если флаг `-S` не задан).


